SSToPer, *nix SSTP client


What is SSTP ?
--------------

Wikipedia says:
"Secure Socket Tunneling Protocol (SSTP) is a form of VPN tunnel that provides a
mechanism to transport PPP or L2TP traffic through an SSL 3.0 channel. SSL
provides transport-level security with key-negotiation, encryption and traffic
integrity checking. The use of SSL over TCP port 443 allows SSTP to pass through
virtually all firewalls and proxy servers."
http://en.wikipedia.org/wiki/Secure_Socket_Tunneling_Protocol


What is SSToPer ?
--------------------

A *nix implementation of the SSTP client, used to establish VPN communication
with MS server (2008 and R2). Since SSTP is only a wrapper over PPP
communication, pppd (http://ppp.samba.org/) MUST be installed with the synchronous
HDLC serial encoding capability enabled.


Features:
---------

- Establishes IP VPN encapsulated inside SSL packets (so it should escape proxies)
- IPv4 support (v6 to be tested)
- HMAC-256 support (HMAC-160 to be tested)
- Provides a Wireshark SSTP dissector to analyse SSTP behaviour
- 


Pre-requisites:
---------------

- libcrypto library (for hmac.h)
- lgnutls library (for gnutls.h and other)
- libbsd library (for util.h)
- HDLC-sync capable pppd must be installed
- root privileges



Installing Wireshark SSTP dissector:
------------------------------------

* Download Wireshark source from http://www.wireshark.org and un-tar archive
* Add "dissectors/packet-sstp.c" in DISSECTOR_SRC section inside `epan/CMakeLists.txt` file
* Add "packet-sstp.c" in DISSECTOR_SRC section inside `epan/dissectors/Makefile.common` file
* Copy sstoper/misc/packet-sstp.c -> wireshark/epan/dissectors/
* In wireshark/ root directory, execute :
{{{
   $ ./autogen.sh && ./configure --with-ssl && make
}}}
* You now have a SSTP-compliant Wireshark version (a simple SSTP negociation
  PCAP file is provided in misc/ directory) which can be started
{{{
   $ sudo ./wireshark  
}}}


Session example:
----------------
- first you need your server PEM-formatted CA file. It can usually be obtained
  like this:
  -> Go to http://<server>/certsrv
     -> Click on "Download a CA certificate, certificate chain, or CRL" link
     -> Select "Base64" as "Encoding method" option
     -> Click on "Download CA certificate" link

- un-tar and compile sstoper
{{{
$ tar xf sstoper.tar.gz
$ cd sstoper && make -f Makefile # or just make
}}}

- execute
{{{
$ sudo ./sstoper -s server -c server.crt -U user -P pass
[!] Using default value: 443.
[!] Using default value: /usr/sbin/pppd.
Connecting to vpn.tweety.looney:443     [OK]
 --> 244 bytes
<-- 123 bytes
[SSTP communication]
(Hit Ctrl-C to close connection)
^CSIG: Closing connection
End of TLS connection. Reason: 2.
Freeing regions.
$ 
}}}


Supported systems:
------------------
Stable :
   * Linux (tested on Fedora 13 x86_64 and Debian Lenny i686)
   * Darwin (Mac OS X - Snow Leopard)

Unstable :
   * FreeBSD (tested on 7.3, 8.1 - i386)
   * OpenBSD (tested on 4.7 - i386)

   
Comments/Bugs:
--------------
Please send me back comments and bugs to <ca __AT__ hsc __DOT__ fr>
